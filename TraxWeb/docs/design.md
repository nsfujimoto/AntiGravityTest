# TraxWeb アプリケーション設計書

## 1. 概要
TraxWebは、戦略ボードゲーム「Trax」をWebブラウザ上でプレイできるアプリケーションです。
HTML/CSS/JavaScriptのみで構成され、特別なバックエンドサーバーを必要としません。
プレイヤー対プレイヤー（ホットシート）モードに加え、AI対戦モードも備えています。

## 2. システム構成
本アプリケーションは、以下のフロントエンド技術で構成されています。
- **HTML5**: アプリケーションの構造定義
- **CSS3**: デザインとレイアウト (Vanilla CSS)
- **JavaScript (ES6+)**: ゲームロジック、AI、DOM操作

## 3. クラス設計
主要なロジックは `script.js` 内にクラスとして実装されています。

### 3.1 `TraxBoard` (モデル)
盤面の状態とゲームルールのロジックを管理します。UIには依存しません。

- **プロパティ**:
  - `board`: 盤面データ（2次元配列）。各セルはタイル定数（ビットマスク）を格納。
  - `minX`, `maxX`, `minY`, `maxY`: 現在タイルが置かれている範囲（描画や判定の最適化に使用）。

- **主なメソッド**:
  - `placeTile(x, y, tile)`: 指定座標にタイルを配置。
  - `getValidTiles(x, y)`: 指定座標に配置可能なタイルのリストを返す。
  - `resolveForcedMoves()`: 強制手（Forced Move）を検出し、自動配置する。違法手（3本以上の同色接続）も検出。
  - `checkWin(color)`: win条件（ループまたはライン）を判定。
  - `tracePath(...)`: タイル上のパスを追跡し、ループやライン長を計算。
  - `clone()`: 盤面の複製を作成（AI探索用）。

### 3.2 `TraxAI` (AIロジック)
対戦AIの思考ルーチンを管理します。

- **アルゴリズム**: Minimax法（Alpha-Beta探索） + 反復深化。
- **主なメソッド**:
  - `getBestMove(board, color)`: 現在の盤面から最善手を探索して返す。
  - `minimax(...)`: 再帰的な探索と評価を行う。
  - `evaluate(...)`: 盤面の評価関数（現在は簡易実装）。

### 3.3 `TraxGame` (コントローラー / ビュー)
ゲームの進行管理とUIの描画を担当します。

- **プロパティ**:
  - `traxBoard`: 現在の `TraxBoard` インスタンス。
  - `currentPlayer`: 現在の手番（WHITE / RED）。
  - `aiEnabled`: AI対戦モードのON/OFF。

- **主なメソッド**:
  - `initUI()`: 盤面要素の生成、イベントリスナーの設定。
  - `render()`: 盤面の再描画。
  - `handleCellClick(x, y)`: プレイヤーのクリック操作のハンドリング。
  - `attemptMove(x, y, tile)`: 手の実行を試行し、結果に応じて描画更新やターン切り替えを行う。
  - `makeAIMove()`: AIに思考させ、手を実行させる。

## 4. データ構造と定数

### 4.1 タイル表現
タイルは4ビットのビットマスクで表現され、接続方向（白のパス）を表します。
- `RIGHT` (0x01)
- `UPPER` (0x02)
- `LEFT`  (0x04)
- `LOWER` (0x08)

例: `VERTICAL_W` (縦の白線) = `UPPER | LOWER`

### 4.2 プレイヤー
- `RED` (1)
- `WHITE` (2)

## 5. UI/UX設計

### 5.1 盤面操作
- **スクロール**: コンテナの中心から開始し、盤面が広がってもスクロールで移動可能。
- **タイル配置**:
  - 空きセルをクリックすると、配置可能なタイルの候補がポップアップで表示される。
  - 候補をクリックして確定。

### 5.2 ハイライト
- **有効手**: 配置可能なセル（隣接タイルがある、または初手の中央）のみクリック可能とし、視覚的にハイライトする。

## 6. ファイル構成
- `index.html`: エントリーポイント。
- `style.css`: スタイル定義。盤面のグリッド表示やタイルのSVGスタイルなど。
- `script.js`: ゲームロジックの全実装。
- `README.md`: 遊び方やルールの説明。
